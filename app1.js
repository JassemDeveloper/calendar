const APP=(()=>{let e=window.document,t=(new Date).getFullYear();let a,n={2022:{A:6,B:27,C:20,D:13,color:"#fff",ramadan:{startDate:"04/02/2022",endDate:"04/30/2022"},holiday:["01/09/2022 L","03/13/2022 L","05/01/2022 H","05/02/2022 H","05/03/2022 H","05/04/2022 H","07/08/2022 H","07/09/2022 H","07/10/2022 H","07/11/2022 H","07/12/2022 R","07/13/2022 R","09/22/2022 R","09/23/2022 N","11/13/2022 L"],schoolHoliday:[]},2023:{A:7,B:28,C:21,D:14,color:"#fff",ramadan:{startDate:"03/23/2023",endDate:"04/20/2023"},holiday:["01/15/2023 L","02/22/2023 N","02/23/2023 R","04/21/2023 H","04/22/2023 H","04/23/2023 H","04/24/2023 H","04/25/2023 R","04/26/2023 R","06/27/2023 H","06/28/2023 H","06/29/2023 H","07/02/2023 R","09/23/2023 N","09/24/2023 R"],schoolHoliday:[]},2024:{A:8,B:29,C:22,D:15,color:"#fff",ramadan:{startDate:"03/11/2024",endDate:"04/08/2024"},holiday:["01/07/2024 H","02/22/2024 N","04/09/2024 H","04/10/2024 H","04/11/2024 H","04/12/2024 H","04/14/2024 R","06/15/2024 H","06/16/2024 H","06/17/2024 H","06/18/2024 H","06/19/2024 R","09/22/2024 H","09/23/2024 N","11/17/2024 H"],schoolHoliday:[]},2025:{A:10,B:31,C:24,D:17,color:"#fff",ramadan:{startDate:"",endDate:""},holiday:[],schoolHoliday:[]}},l=!1,o=!1;document.getElementById("signout_button").style.display="none",document.getElementById("exportTo").style.display="none",document.getElementById("shiftType").style.display="none";async function s(){await gapi.client.init({apiKey:"AIzaSyAK8SHAt3jUwMrywv55SaRf8JRHOhwABR0",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"]}),l=!0,r()}function r(){l&&o&&(document.getElementById("authorize_button").style.display="block",e.querySelector(".progress").style.display="none")}let i=function(e){let t=new Date;return t.setSeconds(t.getSeconds()+parseInt(e)),new Date(t).getTime()};let d,c,h,y=0,u=[],f=[],m=[],g=[],p=[],D={},w=[2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0,2,2,2,2,2,2,2,0,0,1,1,1,1,1,1,1,0,0,3,3,3,3,3,3,3,0,0,0],T=["January","February","March","April","May","June","July","August","September","October","November","December"],b=function(e){let t=1,a="",n=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),l=new Date(e.getFullYear(),e.getMonth(),1).getDay()+1;a+=`\n      <table class='calendar-month'>\n       <tr  class='calendar-month-header'>\n        <th colspan='7'>\n        ${T[e.getMonth()]}\n        </th>\n        </tr>\n       <tr class='calendar-month-days-header'>\n        <td class='calendar-month-day-header'>Sun</td>\n        <td class='calendar-month-day-header'>Mon</td>\n        <td class='calendar-month-day-header'>Tue</td>\n        <td class='calendar-month-day-header'>Wed</td>\n        <td class='calendar-month-day-header'>Thr</td>\n        <td class='calendar-month-day-header'>Fri</td>\n        <td class='calendar-month-day-header'>Sat</td>\n       </tr>\n      `;for(let o=1;o<=n;o++){let n=new Date(e.getFullYear(),e.getMonth(),o).getTime(),s="";if(-1!=u.indexOf(n))s="ramadan";else if(-1!=f.indexOf(n)){let e=f.indexOf(n);s=null!=g[e].split(" ")[1]?g[e].split(" ")[1]:"holiday"}else s="";if(1==t){if(1==o)if(l>0){a+="<tr class='calendar-month-days'>";for(let e=0;e<l;e++)a+=e==l-1?`\n                             <td class='day ${s}' data-date='${n}'>1</td>\n                             `:"\n                             <td class='day'></td>\n                             ";l-1==6?(a+="\n                             </tr>\n                             ",t=0):t=l}else a+=`\n             <tr class='calendar-month-days'>\n            <td class='day ${s}' data-date='${n}'>${o}</td>\n        `;else a+=`\n             <tr class='calendar-month-days'>\n            <td class='day ${s}' data-date='${n}'>${o}</td>\n        `;t++}else 7==t?(t=1,a+=`\n            <td class='day ${s}' data-date='${n}'>${o}</td>\n            </tr>\n             `):(a+=`\n            <td class='day ${s}' data-date='${n}'>${o}</td>\n        `,t++)}return a+="\n      </table>\n      ",a},H=function(e,t,a){let n="",l="",o=[];for(let n=1;n<=t;n++){let s=1==w[a]?"M":2==w[a]?"E":3==w[a]?"N":"OFF";o.push({shiftT:s,shiftL:e,day:t[n],class:"OFF"==s?"day-off-"+e:"day-"+e}),l+=`\n          ${"OFF"==s?"<td class='day-off-"+e+"'>"+s:"<td class='day-"+e+"'>"+s}</td>\n            `,a+=1}return"A"==e?d=a:"B"==e?c=a:"C"==e?h=a:"D"==e&&(y=a),n+=`\n          <tr  class='calendar-month-days'>\n           <td class="shift-${e}">${e}</td>\n            ${l}\n          </tr>\n          `,o},k=function(e,t){let a=new Date(e).getTime(),n=new Date(t).getTime(),l=[];for(;a<=n;)l.push({date:new Date(a),dateTime:a}),a+=864e5;return l},S=function(e){let t=["SUN","MON","TUE","WED","THR","FRI","SAT"],a="",n=new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),l=(new Date(e.getFullYear(),e.getMonth(),1).getDay(),{}),o=[];a+="\n      <div class='membersContainer'></div>\n        ";for(let a=1;a<=n;a++){let n="",l="",s=!1,r=t[new Date(e.getFullYear(),e.getMonth(),a).getDay()],i=new Date(e.getFullYear(),e.getMonth(),a);if(-1!=u.indexOf(i.getTime()))n="ramadan";else if(-1!=f.indexOf(i.getTime())){let e=f.indexOf(i.getTime());null!=g[e].split(" ")[1]&&g[e].split(" ")[1];n=null!=g[e].split(" ")[1]?g[e].split(" ")[1]:"holiday"}if(-1!=m.indexOf(i.getTime())){let e=m.indexOf(i.getTime());l=null!=p[e].split(" ")[1]?p[e].split(" ")[1]:"holiday"}null!=D[i.getTime()]?(s=!0,n+=" note"):s=!1,o.push({weekDayH:r,weekDayN:i.getDate(),class:n+" "+l,hasNote:s,date:i.toLocaleDateString(),dateTime:i.getTime()})}return l.year=new Date(e).getFullYear(),l.totalDays=n,l.month=T[e.getMonth()],l.monthDays=o,l.A=H("A",n,d),l.B=H("B",n,c),l.C=H("C",n,h),l.D=H("D",n,y),l},$=function(e){let t=new Date(e);return`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`};let x=function(e,t){let a=[],l="<div class='full-calendar'>";if("table"==t)for(let t=0;t<12;t++){let n=new Date(e,t,1);l+=b(n),a.push(l)}else if("row"==t){let t=n[e];d=t.A,c=t.B,h=t.C,y=t.D;for(let t=0;t<12;t++){let n=new Date(e,t,1);a.push(S(n))}}return a},E=function(e,t){return obj.getItems("test").map((function(e){return new Date(e.date).getTime()})).sort().forEach((function(e){let t=[];obj.getItems("test").forEach((function(a){new Date(a.date).getTime()==e&&t.push(a)})),D[e]=t})),ramadanDaysObj=k(n[e].ramadan.startDate,n[e].ramadan.endDate),u=ramadanDaysObj.map((function(e){return e.dateTime})),g=n[e].holiday,f=n[e].holiday.map((function(e){return new Date(e.split(" ")[0]).getTime()})),p=n[e].schoolHoliday,m=n[e].schoolHoliday.map((function(e){return new Date(e.split(" ")[0]).getTime()})),x(e,t)},C=function(t,a){(t=>{let a="<table class='table table-bordered text-center'>";t.forEach((e=>{a+='<thead class="table-dark">\n      <tr>\n      <th colspan="2"></th>\n      <th>Days</th>',e.monthDays.forEach((e=>{a+=`<th class="${e.class}">${e.weekDayH}</th>`})),a+=`\n     </tr></thead><tbody>\n      <tr class='table-dark'>\n      <td rowspan="5" class="fs-3 align-middle"> <span class='rotate-text'> ${e.month} </span></td>\n      <td rowspan="5" class="fs-3  align-middle"> <span class='rotate-text'> Groups </span></td>\n      <td >#</td>\n      `,e.monthDays.forEach((e=>{a+=`<td class="${e.class}">${e.weekDayN}</td>`})),a+='</tr><tr><td class="shift-A">A</td>',e.A.forEach((e=>{a+=`<td class='${e.class}'>${e.shiftT}</td>`})),a+='</tr><tr><td class="shift-B">B</td>',e.B.forEach((e=>{a+=`<td class='${e.class}'>${e.shiftT}</td>`})),a+='</tr><tr><td class="shift-C">C</td>',e.C.forEach((e=>{a+=`<td class='${e.class}'>${e.shiftT}</td>`})),a+='</tr><tr><td class="shift-D">D</td>',e.D.forEach((e=>{a+=`<td class='${e.class}'>${e.shiftT}</td>`})),a+="</tr>"})),a+="</tbody></table>",e.querySelector(".generated-result").innerHTML=a})(E(t,a))};async function A(t){e.querySelector(".progress").style.display="block";const a="Shift Schedule";let n="";const l={resource:{summary:a}},o=await gapi.client.calendar.calendarList.list({});let s=!1;o.result.items.forEach((e=>{let{summary:t,id:l}=e;t==a&&(s=!0,n=l)}));let r="";if(s){await gapi.client.calendar.calendars.delete({calendarId:n});const e=await gapi.client.calendar.calendars.insert(l);r=e.result.id}if(!s){const e=await gapi.client.calendar.calendars.insert(l);r=e.result.id}let i=0,d=1;e.querySelector(".progress-title").style.display="none",t.forEach((async a=>{setTimeout((async()=>{await gapi.client.calendar.events.insert({calendarId:r,resource:a}),console.log(d),d+=1,function(t,a){let n=e.querySelector(".progress-bar-track"),l=Math.ceil(t/a*100);n.style=`width:${l}%`,n.innerHTML=`${l}%`}(d,t.length)}),1e3+i),i+=1e3}))}let v=function(){let e=E(t,"row"),a=["A","B","C","D"],n=[];for(var l=0;l<e.length;l++){let t=[],i=[],d=[];i.push({text:"",colSpan:2,style:"header1"},{},{text:"Days",style:"header1"}),d.push({text:e[l].month,rowSpan:5,style:"header"},{text:"Groups",rowSpan:5,style:"header"},{text:"#",style:"header1"});for(var o=0;o<e[l].monthDays.length;o++){let t="header1";" "!=e[l].monthDays[o].class&&(t=e[l].monthDays[o].class.replace(/-/g,"")),i.push({text:e[l].monthDays[o].weekDayH,style:t.trim()}),d.push({text:e[l].monthDays[o].weekDayN,style:t.trim()})}t.push(i),t.push(d);for(var s=0;s<a.length;s++){let n=[];n.push({},{},{text:a[s],style:"shift"+a[s]});for(var r=0;r<e[l][a[s]].length;r++)n.push({text:e[l][a[s]][r].shiftT,style:e[l][a[s]][r].class.replace(/-/g,"")});t.push(n)}n.push({margin:[-35,5],table:{headerRows:6,width:["auto"],body:t}})}n.push({columns:[{width:"*",text:""},{width:"auto",table:{body:[[{text:"Ramadan",style:"ramadan",margin:[5,5]},{},{text:"Rescheduled days off",style:"R",margin:[5,5]},{},{text:"National/Founding Day",style:"N",margin:[5,5]},{},{text:"Holidays",style:"H",margin:[5,5]},{},{text:"Weekends",style:"L",margin:[5,5]}]]},layout:"noBorders"},{width:"*",text:""}]}),n.push({table:{body:[[{text:"Developed by Jassem"}]]},layout:"noBorders"});var i={info:{title:e[0].year+" Shift Schedule",author:"https://jassemdeveloper.github.io/",subject:e[0].year+" Shift Schedule"},pageSize:{width:1165,height:"auto"},defaultStyle:{fontSize:12,alignment:"center"},header:{text:e[0].year+" Shift Schedule",fontSize:30,margin:[0,4],bold:!0,alignment:"center"},pageOrientation:"portrait",content:n,styles:{header:{margin:[0,30],color:"white",fillColor:"#212529"},header1:{color:"white",fillColor:"#212529"},R:{fillColor:"#FDB121",color:"white"},H:{fillColor:"#00DFFF",color:"white"},N:{fillColor:"#993299",color:"white"},L:{fillColor:"#407294",color:"white"},ramadan:{fillColor:"#20B2AA",color:"white"},shiftA:{fillColor:"#00768B",color:"white"},dayoffA:{fillColor:"#00768B",color:"white"},shiftB:{fillColor:"#1EA0A5",color:"white"},dayoffB:{fillColor:"#1EA0A5",color:"white"},shiftC:{fillColor:"#004C48",color:"white"},dayoffC:{fillColor:"#004C48",color:"white"},shiftD:{fillColor:"#B44237",color:"white"},dayoffD:{fillColor:"#B44237",color:"white"}}};pdfMake.createPdf(i).download(e[0].year+" Shift Schedule.pdf")},B=async function(e){let a=function(e,t,a){obj.getItems("test").map((function(e){return new Date(e.date).getTime()})).sort().forEach((function(e){let t=[];obj.getItems("test").forEach((function(a){new Date(a.date).getTime()==e&&t.push(a)})),D[e]=t})),ramadanDaysObj=k(n[e].ramadan.startDate,n[e].ramadan.endDate),u=ramadanDaysObj.map((function(e){return e.dateTime})),g=n[e].holiday,f=n[e].holiday.map((function(e){return new Date(e.split(" ")[0]).getTime()})),p=n[e].schoolHoliday,m=n[e].schoolHoliday.map((function(e){return new Date(e.split(" ")[0]).getTime()}));let l=x(e,t),o=[];l.forEach((e=>{let t=[];for(let n=0;n<e.monthDays.length;n++){let l="";"H"==e.monthDays[n].class.trim()?l="Holiday":"L"==e.monthDays[n].class.trim()?l="Long weekend":"N"==e.monthDays[n].class.trim()?l="National Day":"R"==e.monthDays[n].class.trim()?l="Rescheduled Day":("ramadan"==e.monthDays[n].class.trim()||"ramadan"==e.monthDays[n].class.trim())&&(l="Ramadan");let o="";"M"==e[a][n].shiftT?o="Morning":"E"==e[a][n].shiftT?o="Evening":"N"==e[a][n].shiftT?o="Night":"OFF"==e[a][n].shiftT&&(o="DAY-OFF"),t.push({class:e.monthDays[n].class,date:$(e.monthDays[n].date),weekDayH:e.monthDays[n].weekDayH,weekDayN:e.monthDays[n].weekDayN,shiftT:e[a][n].shiftT,shiftType:o,shiftL:e[a][n].shiftL,classAction:`${""!=l?l+"**"+o:o}`})}o.push({month:e.month,monthDays:e.monthDays,shiftLetter:a,shiftData:e[a],allData:t})}));let s=[];return o.forEach((e=>{e.allData.forEach((e=>{s.push({summary:e.classAction,colorId:"OFF"==e.shiftT.trim()?10:"M"==e.shiftT.trim()?7:"E"==e.shiftT.trim()?5:1,start:{date:e.date},end:{date:e.date}})}))})),s}(t,"row",e);await A(a)};return(()=>{let a=e.querySelector(".year-selection"),l=Object.keys(n),o="<div class='row'>\n        <div class='col-sm-12 col-lg-4 col-md-4 m-auto'>\n        <h3 class='text-center'>Which year would you like to show ?</h3>\n        <select class='form-select form-select-lg col-3' id='year-selection'>";l.forEach((e=>{o+=t==e?`<option value='${e}' selected>${e}</option>`:`<option value='${e}'>${e}</option>`})),o+="</select></div></div>",a.innerHTML=o,e.querySelector("#year-selection").addEventListener("change",(e=>{let a=e.target.value;t=a,C(a,"row")}))})(),e.querySelector("#generatePDF").addEventListener("click",v),{generateFullYearCalendar:C,gapiLoaded:function(){gapi.load("client",s)},gisLoaded:function(){a=google.accounts.oauth2.initTokenClient({client_id:"61736859691-5fmjquh8ud2skc1gvgfqogjb43ueh44a.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/calendar",callback:""}),o=!0,r()},handleAuthClick:function(){a.callback=async e=>{if(void 0!==e.error)throw e;document.getElementById("signout_button").style.display="block",document.getElementById("exportTo").style.display="block",document.getElementById("shiftType").style.display="block",document.getElementById("authorize_button").style.display="none",function(){let e=document.querySelector("#shiftType").value;document.querySelector("#shiftType").addEventListener("change",(function(t){e=t.target.value})),document.querySelector("#exportTo").addEventListener("click",(function(){e.length>0?confirm("Do you want to export records to Google Calendar?")&&B(e):alert("please select your shift")}))}()},null===gapi.client.getToken()?a.requestAccessToken({prompt:"consent"}):a.requestAccessToken({prompt:""})},handleSignoutClick:function(){const e=gapi.client.getToken();null!==e&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken(""),document.getElementById("content").innerText="",document.getElementById("authorize_button").innerText="Authorize",document.getElementById("signout_button").style.display="none")},gapi_token_localstorage:function(){let e=gapi.client.getToken(),t=JSON.stringify(e),a=i(e.expires_in);localStorage.setItem("token",t),localStorage.setItem("token_expire",a)},check_token:function(){let e=JSON.parse(localStorage.getItem("token_expire"));return!((new Date).getTime()>new Date(e.expire_in).getTime())},startProgress:function(t){let a=e.querySelector(".progress-bar-track"),n=1;for(let e=1;e<=t;e++)n=Math.ceil(e/t*100),n<=100&&(a.style=`width:${n}%`,a.innerHTML=`${n}%`)}}})();APP.generateFullYearCalendar((new Date).getFullYear(),"row");